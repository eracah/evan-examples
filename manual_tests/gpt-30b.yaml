integrations:
  - integration_type: git_repo
    git_repo: mosaicml/examples
    git_commit: 7117377bdfbcb1c03c4937d308c71179057ff961
  - integration_type: wandb
    entity: mosaic-ml
    project: evan-fsdp-ckpt-test

command: |
  cd examples/llm
  python ../scripts/convert_c4.py --out_root ./my-copy-c4 --splits train_small val
  composer main.py yamls/mosaic_gpt/30b.yaml \
    train_loader.dataset.split=train_small \
    global_train_batch_size=64 \
    device_train_microbatch_size=1 \
    fsdp_config.activation_checkpointing=true \
    fsdp_config.activation_cpu_offload=true \
    max_duration=3ba \
    callbacks.speed_monitor.window_size=1 \
    eval_interval=0 \
    save_folder='s3://mosaicml-internal-checkpoints-test/evan-test/checkpoints/{run_name}' \
    loggers='{wandb:{}}' \
    run_name=$COMPOSER_RUN_NAME
  ls './checkpoints'
  du -sh './checkpoints'

image: mosaicml/examples:llm-7117377
optimization_level: 0

run_name: 30b-fast-gpus-64

gpu_num: 16
cluster: r7z2

parameters: {}
