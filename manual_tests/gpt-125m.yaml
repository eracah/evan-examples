integrations:
  - integration_type: git_repo
    git_repo: mosaicml/examples
    git_commit: 7117377bdfbcb1c03c4937d308c71179057ff961
  - integration_type: git_repo
    git_repo: eracah/evan-composer
    git_branch: log-nodename
    pip_install: -e .[all]
  - integration_type: wandb
    entity: mosaic-ml
    project: evan-gpt-125m


command: |
  cd examples/llm
  python ../scripts/convert_c4.py --out_root ./my-copy-c4 --splits train_small val
  composer main.py yamls/mosaic_gpt/125m.yaml \
    train_loader.dataset.split=train_small \
    global_train_batch_size=32 \
    device_train_microbatch_size=1 \
    fsdp_config.activation_checkpointing=true \
    fsdp_config.activation_cpu_offload=true \
    max_duration=10ba \
    callbacks.speed_monitor.window_size=1 \
    eval_interval=2ba \
    eval_subset_num_batches=320 \
    save_folder='./checkpoints' \
    save_interval=5ba \
    loggers='{wandb:{rank_zero_only: False}}' \
    run_name=$COMPOSER_RUN_NAME
  ls -lh  './checkpoints'
  du -sh './checkpoints'

image: mosaicml/examples:llm-7117377
optimization_level: 0

run_name: log-nodename-gpt-125m

gpu_num: 16
cluster: r7z2
parameters: {}
